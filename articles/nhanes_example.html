<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Multibias example: NHANES • multibias</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Multibias example: NHANES">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">multibias</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/multibias.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/faq.html">FAQ</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/nhanes_example.html">NHANES Example</a></li>
    <li><a class="dropdown-item" href="../articles/evans_example.html">Evans Example</a></li>
    <li><a class="dropdown-item" href="../articles/multibias_validation.html">Multibias Validation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pcbrendel/multibias/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Multibias example: NHANES</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pcbrendel/multibias/blob/master/vignettes/nhanes_example.Rmd" class="external-link"><code>vignettes/nhanes_example.Rmd</code></a></small>
      <div class="d-none name"><code>nhanes_example.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Epidemiologic studies often face multiple sources of bias, including
confounding, measurement error, and selection bias. Investigators
typically address these biases by speculating on the direction of their
effect or by adjusting for a single source of bias. The
<code>multibias</code> package provides a framework for simultaneously
adjusting for multiple sources of bias.</p>
<p>This vignette demonstrates how to use <code>multibias</code> to
analyze the relationship between alcohol consumption and mortality using
data from the National Health and Nutrition Examination Survey (NHANES).
We’ll progressively add different types of bias adjustments to show how
each affects our estimates and how they can be combined for a more
comprehensive analysis.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/pcbrendel/multibias" class="external-link">multibias</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>For this demonstration, we’ll use the 2013-2018 <a href="https://www.cdc.gov/nchs/nhanes/about/index.html" class="external-link">National Health
and Nutrition Examination Survey</a> (NHANES) data linked to the <a href="https://www.cdc.gov/nchs/data-linkage/mortality-public.htm" class="external-link">CDC’s
2019 public-use mortality data</a>. This dataset provides a rich source
of information including:</p>
<ul>
<li>Demographics</li>
<li>24-hour dietary recall</li>
<li>Alcohol consumption patterns</li>
<li>Smoking history</li>
<li>Mortality outcomes</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nhanes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"nhanes.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-preparation-and-exploration">Data Preparation and Exploration<a class="anchor" aria-label="anchor" href="#data-preparation-and-exploration"></a>
</h2>
<p>We’ll be assessing the risk of alcohol intake on all-cause mortality,
specifically comparing “extreme” drinkers to “non-extreme” drinkers.
Let’s first understand our data and create our exposure variable.</p>
<div class="section level3">
<h3 id="creating-the-exposure-variable">Creating the Exposure Variable<a class="anchor" aria-label="anchor" href="#creating-the-exposure-variable"></a>
</h3>
<p>We’ll anchor our classification based on the US Dietary Guidelines
for Americans (USDGA) suggested limit:</p>
<ul>
<li>14 g/day for women</li>
<li>28 g/day for men</li>
</ul>
<p>Participants are classified as “extreme drinkers” if they reported
drinking more than 1.5x these guidelines.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nhanes_filtered</span> <span class="op">&lt;-</span> <span class="va">nhanes</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>alcohol_extreme <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">alcohol_day_total</span> <span class="op">&gt;</span> <span class="fl">14</span> <span class="op">*</span> <span class="fl">1.5</span> <span class="op">&amp;</span> <span class="va">gender_female</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>    <span class="va">alcohol_day_total</span> <span class="op">&gt;</span> <span class="fl">28</span> <span class="op">*</span> <span class="fl">1.5</span> <span class="op">&amp;</span> <span class="va">gender_female</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&gt;=</span> <span class="fl">18</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">eligstat</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">alcohol_12mo</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-characteristics">Data Characteristics<a class="anchor" aria-label="anchor" href="#data-characteristics"></a>
</h3>
<p>Let’s examine the key characteristics of our dataset:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exposure_outcome_table</span> <span class="op">&lt;-</span> <span class="va">nhanes_filtered</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">alcohol_extreme</span>, <span class="va">mortstat</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>proportion <span class="op">=</span> <span class="va">count</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'alcohol_extreme'. You can override using</span></span>
<span><span class="co">#&gt; the `.groups` argument.</span></span>
<span></span>
<span><span class="co"># Distribution of Exposure and Outcome:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">exposure_outcome_table</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 4</span></span></span>
<span><span class="co">#&gt;   alcohol_extreme mortstat count proportion</span></span>
<span><span class="co">#&gt;             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>               0        0  <span style="text-decoration: underline;">8</span>412    0.856  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>               0        1   281    0.028<span style="text-decoration: underline;">6</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>               1        0  <span style="text-decoration: underline;">1</span>089    0.111  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>               1        1    44    0.004<span style="text-decoration: underline;">48</span></span></span>
<span></span>
<span><span class="va">demographic_table</span> <span class="op">&lt;-</span> <span class="va">nhanes_filtered</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">alcohol_extreme</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    age_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>,</span>
<span>    age_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>,</span>
<span>    gender_prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">gender_female</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    alcohol_extreme <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span></span>
<span>      <span class="va">alcohol_extreme</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"Extreme"</span>, <span class="st">"Non-extreme"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Demographic Characteristics by Exposure Status:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">demographic_table</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">#&gt;   alcohol_extreme     n age_mean age_sd gender_prop</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Non-extreme      <span style="text-decoration: underline;">8</span>693     46.2   17.8       0.486</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Extreme          <span style="text-decoration: underline;">1</span>133     45.1   15.8       0.454</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="multiple-bias-analysis">Multiple Bias Analysis<a class="anchor" aria-label="anchor" href="#multiple-bias-analysis"></a>
</h2>
<p>We’ll now progressively adjust for three types of bias:</p>
<ol style="list-style-type: decimal">
<li>Uncontrolled confounding (smoking status)</li>
<li>Exposure misclassification (alcohol underreporting)</li>
<li>Selection bias (NHANES sampling weights)</li>
</ol>
<div class="section level3">
<h3 id="adjusting-for-uncontrolled-confounding">1. Adjusting for Uncontrolled Confounding<a class="anchor" aria-label="anchor" href="#adjusting-for-uncontrolled-confounding"></a>
</h3>
<p>Smoking is a strong confounder in the relationship between alcohol
consumption and mortality. Smokers are more likely to be heavy drinkers,
and smoking independently increases mortality risk. Our observed data
doesn’t account for this, potentially leading to biased estimates.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create observed data object with uncontrolled confounding bias</span></span>
<span><span class="va">df_obs1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_observed.html">data_observed</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">nhanes_filtered</span>,</span>
<span>  bias <span class="op">=</span> <span class="st">"uc"</span>,</span>
<span>  exposure <span class="op">=</span> <span class="st">"alcohol_extreme"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"mortstat"</span>,</span>
<span>  confounders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"gender_female"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">df_obs1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note: Estimates are exponentiated (odds ratios) for binary outcomes</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 7</span></span></span>
<span><span class="co">#&gt;   term            estimate std.error statistic   p.value conf.low conf.high</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> (Intercept)     0.000<span style="text-decoration: underline;">364</span>   0.309      -<span style="color: #BB0000;">25.6</span>  4.34<span style="color: #949494;">e</span><span style="color: #BB0000;">-145</span> 0.000<span style="text-decoration: underline;">195</span>  0.000<span style="text-decoration: underline;">655</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> alcohol_extreme 1.56       0.173        2.58 9.94<span style="color: #949494;">e</span><span style="color: #BB0000;">-  3</span> 1.10      2.17    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> age             1.09       0.004<span style="text-decoration: underline;">52</span>     18.1  3.25<span style="color: #949494;">e</span><span style="color: #BB0000;">- 73</span> 1.08      1.10    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> gender_female   0.684      0.120       -<span style="color: #BB0000;">3.17</span> 1.54<span style="color: #949494;">e</span><span style="color: #BB0000;">-  3</span> 0.539     0.864</span></span></code></pre></div>
<p>Running the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> method on our
<code>data_observed</code> object prints the logistic regression results
from the model estimating the association between extreme alcohol
consumption and mortality, adjusting for age and gender. This will serve
as our reference point for comparing bias-adjusted estimates. Our base
model suggests that extreme alcohol consumption is associated with a
1.6-fold increase in mortality risk (95% CI: 1.1, 2.17), after adjusting
for age and gender.</p>
<p>To adjust for the bias here, we’ll leverage a validation dataset; for
a fraction of our cohort of patients, we have smoking information
available.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create validation data with smoking information</span></span>
<span><span class="va">df_temp1</span> <span class="op">&lt;-</span> <span class="va">nhanes_filtered</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">smoked_100cigs</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_val1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_validation.html">data_validation</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">df_temp1</span>,</span>
<span>  true_exposure <span class="op">=</span> <span class="st">"alcohol_extreme"</span>,</span>
<span>  true_outcome <span class="op">=</span> <span class="st">"mortstat"</span>,</span>
<span>  confounders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"gender_female"</span>, <span class="st">"smoked_100cigs"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Perform bias adjustment</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">uc_adjusted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multibias_adjust.html">multibias_adjust</a></span><span class="op">(</span></span>
<span>  <span class="va">df_obs1</span>,</span>
<span>  <span class="va">df_val1</span>,</span>
<span>  bootstrap <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  bootstrap_reps <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Uncontrolled Confounding Adjusted Results:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">uc_adjusted</span><span class="op">)</span></span>
<span><span class="co">#&gt; $estimate</span></span>
<span><span class="co">#&gt; [1] 1.382805</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $std.error</span></span>
<span><span class="co">#&gt; [1] 0.2386598</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ci</span></span>
<span><span class="co">#&gt; [1] 1.032700 2.013323</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adding-exposure-misclassification-adjustment">2. Adding Exposure Misclassification Adjustment<a class="anchor" aria-label="anchor" href="#adding-exposure-misclassification-adjustment"></a>
</h3>
<p>Self-reported alcohol consumption is often underreported due to
social stigma. We’ll adjust for this by assuming that certain
demographic groups (wealthy, college-educated individuals) are more
likely to under-report their alcohol consumption.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create observed data object with both biases</span></span>
<span><span class="va">df_obs2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_observed.html">data_observed</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">nhanes_filtered</span>,</span>
<span>  bias <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"em"</span>, <span class="st">"uc"</span><span class="op">)</span>,</span>
<span>  exposure <span class="op">=</span> <span class="st">"alcohol_extreme"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"mortstat"</span>,</span>
<span>  confounders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"gender_female"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create validation data with adjusted alcohol consumption</span></span>
<span><span class="va">df_temp2</span> <span class="op">&lt;-</span> <span class="va">nhanes_filtered</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">smoked_100cigs</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># Assume 50% higher consumption for high SES individuals</span></span>
<span>    alcohol_adj <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span></span>
<span>      <span class="va">income</span> <span class="op">==</span> <span class="st">"$100,000 and Over"</span> <span class="op">|</span> <span class="va">education</span> <span class="op">==</span> <span class="st">"College graduate or above"</span>,</span>
<span>      <span class="va">alcohol_day_total</span> <span class="op">*</span> <span class="fl">1.5</span>,</span>
<span>      <span class="va">alcohol_day_total</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>alcohol_extreme_adj <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">alcohol_adj</span> <span class="op">&gt;</span> <span class="fl">14</span> <span class="op">*</span> <span class="fl">1.5</span> <span class="op">&amp;</span> <span class="va">gender_female</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>    <span class="va">alcohol_adj</span> <span class="op">&gt;</span> <span class="fl">28</span> <span class="op">*</span> <span class="fl">1.5</span> <span class="op">&amp;</span> <span class="va">gender_female</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_val2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_validation.html">data_validation</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">df_temp2</span>,</span>
<span>  true_exposure <span class="op">=</span> <span class="st">"alcohol_extreme_adj"</span>,</span>
<span>  true_outcome <span class="op">=</span> <span class="st">"mortstat"</span>,</span>
<span>  confounders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"gender_female"</span>, <span class="st">"smoked_100cigs"</span><span class="op">)</span>,</span>
<span>  misclassified_exposure <span class="op">=</span> <span class="st">"alcohol_extreme"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Perform bias adjustment</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">uc_em_adjusted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multibias_adjust.html">multibias_adjust</a></span><span class="op">(</span></span>
<span>  <span class="va">df_obs2</span>,</span>
<span>  <span class="va">df_val2</span>,</span>
<span>  bootstrap <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  bootstrap_reps <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Exposure Misclassification &amp; Confounding Adjusted Results:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">uc_em_adjusted</span><span class="op">)</span></span>
<span><span class="co">#&gt; $estimate</span></span>
<span><span class="co">#&gt; [1] 1.066144</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $std.error</span></span>
<span><span class="co">#&gt; [1] 0.1963944</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ci</span></span>
<span><span class="co">#&gt; [1] 0.8050004 1.5324897</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adding-selection-bias-adjustment">3. Adding Selection Bias Adjustment<a class="anchor" aria-label="anchor" href="#adding-selection-bias-adjustment"></a>
</h3>
<p>NHANES uses a complex sampling design with oversampling of certain
demographic groups. This can create selection bias if both the exposure
(alcohol consumption) and outcome (mortality) are related to the
selection probability. We’ll adjust for this using the NHANES sampling
weights.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create observed data object with all three biases</span></span>
<span><span class="va">df_obs3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_observed.html">data_observed</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">nhanes_filtered</span>,</span>
<span>  bias <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"em"</span>, <span class="st">"uc"</span>, <span class="st">"sel"</span><span class="op">)</span>,</span>
<span>  exposure <span class="op">=</span> <span class="st">"alcohol_extreme"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"mortstat"</span>,</span>
<span>  confounders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"gender_female"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare data for selection bias adjustment</span></span>
<span><span class="va">df_temp3a</span> <span class="op">&lt;-</span> <span class="va">nhanes_filtered</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">smoked_100cigs</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    alcohol_adj <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span></span>
<span>      <span class="va">income</span> <span class="op">==</span> <span class="st">"$100,000 and Over"</span> <span class="op">|</span> <span class="va">education</span> <span class="op">==</span> <span class="st">"College graduate or above"</span>,</span>
<span>      <span class="va">alcohol_day_total</span> <span class="op">*</span> <span class="fl">1.5</span>,</span>
<span>      <span class="va">alcohol_day_total</span></span>
<span>    <span class="op">)</span>,</span>
<span>    alcohol_extreme_adj <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">alcohol_adj</span> <span class="op">&gt;</span> <span class="fl">14</span> <span class="op">*</span> <span class="fl">1.5</span> <span class="op">&amp;</span> <span class="va">gender_female</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>      <span class="va">alcohol_adj</span> <span class="op">&gt;</span> <span class="fl">28</span> <span class="op">*</span> <span class="fl">1.5</span> <span class="op">&amp;</span> <span class="va">gender_female</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co"># Combine survey weights</span></span>
<span>    weight <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">weight_day2</span> <span class="op">==</span> <span class="fl">0</span>, <span class="va">weight_day1</span>, <span class="va">weight_day2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Create selection indicator based on sampling weights</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">selected_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">df_temp3a</span><span class="op">$</span><span class="va">seqn</span>,</span>
<span>  size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_temp3a</span><span class="op">)</span>,</span>
<span>  replace <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  prob <span class="op">=</span> <span class="va">df_temp3a</span><span class="op">$</span><span class="va">weight</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_selected_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">id</span> <span class="kw">in</span> <span class="va">selected_sample</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df_selected_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>    <span class="va">df_selected_sample</span>,</span>
<span>    <span class="va">df_temp3a</span><span class="op">[</span><span class="va">df_temp3a</span><span class="op">$</span><span class="va">seqn</span> <span class="op">==</span> <span class="va">id</span>, <span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">df_selected_sample</span><span class="op">$</span><span class="va">selection</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">df_not_selected_sample</span> <span class="op">&lt;-</span> <span class="va">df_temp3a</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">df_temp3a</span><span class="op">$</span><span class="va">seqn</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">selected_sample</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">df_not_selected_sample</span><span class="op">$</span><span class="va">selection</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="va">df_temp3b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">df_selected_sample</span>, <span class="va">df_not_selected_sample</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create validation data with selection information</span></span>
<span><span class="va">df_val3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_validation.html">data_validation</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">df_temp3b</span>,</span>
<span>  true_exposure <span class="op">=</span> <span class="st">"alcohol_extreme_adj"</span>,</span>
<span>  true_outcome <span class="op">=</span> <span class="st">"mortstat"</span>,</span>
<span>  confounders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"gender_female"</span>, <span class="st">"smoked_100cigs"</span><span class="op">)</span>,</span>
<span>  misclassified_exposure <span class="op">=</span> <span class="st">"alcohol_extreme"</span>,</span>
<span>  selection <span class="op">=</span> <span class="st">"selection"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Perform final bias adjustment</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">final_adjusted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multibias_adjust.html">multibias_adjust</a></span><span class="op">(</span></span>
<span>  <span class="va">df_obs3</span>,</span>
<span>  <span class="va">df_val3</span>,</span>
<span>  bootstrap <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  bootstrap_reps <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Triple Bias Adjusted Results:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">final_adjusted</span><span class="op">)</span></span>
<span><span class="co">#&gt; $estimate</span></span>
<span><span class="co">#&gt; [1] 1.082248</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $std.error</span></span>
<span><span class="co">#&gt; [1] 0.1913425</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ci</span></span>
<span><span class="co">#&gt; [1] 0.7367791 1.6108455</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="visualize-results">Visualize Results<a class="anchor" aria-label="anchor" href="#visualize-results"></a>
</h2>
<p>Let’s visualize the sensitivity analysis to observe how our estimates
change with each bias adjustment:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/multibias_plot.html">multibias_plot</a></span><span class="op">(</span></span>
<span>  <span class="va">df_obs1</span>,</span>
<span>  multibias_result_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"Adjusted - Single Bias"</span> <span class="op">=</span> <span class="va">uc_adjusted</span>,</span>
<span>    <span class="st">"Adjusted - Double Biases"</span> <span class="op">=</span> <span class="va">uc_em_adjusted</span>,</span>
<span>    <span class="st">"Adjusted - Triple Biases"</span> <span class="op">=</span> <span class="va">final_adjusted</span></span>
<span>  <span class="op">)</span>,</span>
<span>  log_scale <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="nhanes_example_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="discussion">Discussion<a class="anchor" aria-label="anchor" href="#discussion"></a>
</h2>
<p>This analysis demonstrates how multiple sources of bias can affect
the estimated relationship between alcohol consumption and
mortality:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Uncontrolled Confounding</strong>: Adjusting for smoking
status reduced the odds ratio from 1.56 to 1.38, suggesting that part of
the observed association was due to the confounding effect of
smoking.</p></li>
<li><p><strong>Exposure Misclassification</strong>: Further adjustment
for potential underreporting of alcohol consumption reduced the odds
ratio to 1.07, indicating that measurement error may have led to an
overestimate of the true effect.</p></li>
<li><p><strong>Selection Bias</strong>: The final adjustment for NHANES
sampling weights had minimal impact on the estimate, suggesting that
selection bias may not be a major concern in this analysis.</p></li>
</ol>
<p>These results highlight the importance of considering multiple
sources of bias simultaneously. The <code>multibias</code> package
provides a flexible framework for such analyses, allowing researchers to
incorporate various assumptions about bias mechanisms and assess their
impact on study results.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul Brendel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>

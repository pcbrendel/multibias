<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Multibias example: NHANES • multibias</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Multibias example: NHANES">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">multibias</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.6.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/multibias.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/evans_example.html">Multibias example: Evans</a></li>
    <li><a class="dropdown-item" href="../articles/multibias_validation.html">Multibias Validation</a></li>
    <li><a class="dropdown-item" href="../articles/nhanes_example.html">Multibias example: NHANES</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pcbrendel/multibias/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Multibias example: NHANES</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pcbrendel/multibias/blob/master/vignettes/nhanes_example.Rmd" class="external-link"><code>vignettes/nhanes_example.Rmd</code></a></small>
      <div class="d-none name"><code>nhanes_example.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/pcbrendel/multibias" class="external-link">multibias</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<p>For this demonstration in multi-bias analysis, we’ll be using the
2013-2018 National Health and Nutrition Examination Survey (NHANES) data
linked to the CDC’s 2019 public-use mortality data. Within NHANES, we
have data linked across demographics, 24-hour dietary recall, alcohol
use, and smoking use.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nhanes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"nhanes.csv"</span><span class="op">)</span></span></code></pre></div>
<p>We’ll be assessing the risk of alcohol intake on all-cause mortality.
We’re specifically going to zoom in on the comparison of “extreme”
drinkers to “non-extreme” drinkers. We filter out participants who
reported having no alcohol over the past twelve months and create a
sex-specific <code>alcohol_extreme</code> feature based off of USDGA
guidelines of 14 g/day for women and 28 g/day for men. Participants are
“extreme drinkers” if they reported drinking more than 1.5x these
guidelines.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nhanes_filtered</span> <span class="op">&lt;-</span> <span class="va">nhanes</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>alcohol_extreme <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">alcohol_day_total</span> <span class="op">&gt;</span> <span class="fl">14</span> <span class="op">*</span> <span class="fl">1.5</span> <span class="op">&amp;</span> <span class="va">gender_female</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>    <span class="va">alcohol_day_total</span> <span class="op">&gt;</span> <span class="fl">28</span> <span class="op">*</span> <span class="fl">1.5</span> <span class="op">&amp;</span> <span class="va">gender_female</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&gt;=</span> <span class="fl">18</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">eligstat</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">alcohol_12mo</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>Inspecting the exposure-outcome counts, we are dealing with a rare
exposure and rare outcome.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nhanes_filtered</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">alcohol_extreme</span>, <span class="va">mortstat</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>proportion <span class="op">=</span> <span class="va">count</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'alcohol_extreme'. You can override using</span></span>
<span><span class="co">#&gt; the `.groups` argument.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 4</span></span></span>
<span><span class="co">#&gt;   alcohol_extreme mortstat count proportion</span></span>
<span><span class="co">#&gt;             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>               0        0  <span style="text-decoration: underline;">8</span>412    0.856  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>               0        1   281    0.028<span style="text-decoration: underline;">6</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>               1        0  <span style="text-decoration: underline;">1</span>089    0.111  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>               1        1    44    0.004<span style="text-decoration: underline;">48</span></span></span></code></pre></div>
<p>There are no major age/gender differences among the exposures.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nhanes_filtered</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">alcohol_extreme</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    age_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>,</span>
<span>    gender_prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">gender_female</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 3</span></span></span>
<span><span class="co">#&gt;   alcohol_extreme age_mean gender_prop</span></span>
<span><span class="co">#&gt;             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>               0     46.2       0.486</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>               1     45.1       0.454</span></span></code></pre></div>
<p>To no surprise, age is higher in those who die.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nhanes_filtered</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">mortstat</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    age_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>,</span>
<span>    gender_prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">gender_female</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 3</span></span></span>
<span><span class="co">#&gt;   mortstat age_mean gender_prop</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>        0     45.4       0.486</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>        1     66.2       0.375</span></span></code></pre></div>
<p>Now tht we’ve loaded and inspected the data, let’s fit our base model
for reference: a logistic regression of mortality on alcohol, gender,
and age. For our exposure of interest, we observe an odds ratio of 1.6
(95% CI: 1.1, 2.2) indicating increased mortality risk among the extreme
drinkers, adjusted for age and gender. Note that many important
covariates and considerations are not considered here.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span></span>
<span>  <span class="va">mortstat</span> <span class="op">~</span> <span class="va">alcohol_extreme</span> <span class="op">+</span> <span class="va">gender_female</span> <span class="op">+</span> <span class="va">age</span>,</span>
<span>  data <span class="op">=</span> <span class="va">nhanes_filtered</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">base_mod</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;     (Intercept) alcohol_extreme   gender_female             age </span></span>
<span><span class="co">#&gt;    0.0003640025    1.5603553141    0.6838661096    1.0852279381</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">base_mod</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Waiting for profiling to be done...</span></span>
<span><span class="co">#&gt;                        2.5 %       97.5 %</span></span>
<span><span class="co">#&gt; (Intercept)     0.0001952562 0.0006553778</span></span>
<span><span class="co">#&gt; alcohol_extreme 1.0999439503 2.1670092413</span></span>
<span><span class="co">#&gt; gender_female   0.5393792722 0.8637743150</span></span>
<span><span class="co">#&gt; age             1.0758586614 1.0950985762</span></span></code></pre></div>
<p>The family of functions in <code>multibias</code> requires inputting
the observed data as a <code><a href="../reference/data_observed.html">data_observed()</a></code> object.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_observed.html">data_observed</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">nhanes_filtered</span>,</span>
<span>  exposure <span class="op">=</span> <span class="st">"alcohol_extreme"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"mortstat"</span>,</span>
<span>  confounders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"gender_female"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_obs</span><span class="op">)</span></span>
<span><span class="co">#&gt; Observed Data</span></span>
<span><span class="co">#&gt; ------------------</span></span>
<span><span class="co">#&gt; Exposure: alcohol_extreme </span></span>
<span><span class="co">#&gt; Outcome: mortstat </span></span>
<span><span class="co">#&gt; Confounders: age, gender_female </span></span>
<span><span class="co">#&gt; Data head: </span></span>
<span><span class="co">#&gt;   alcohol_extreme mortstat age gender_female</span></span>
<span><span class="co">#&gt; 1               0        0  69             0</span></span>
<span><span class="co">#&gt; 2               1        1  54             0</span></span>
<span><span class="co">#&gt; 3               0        0  56             0</span></span>
<span><span class="co">#&gt; 4               0        0  61             1</span></span>
<span><span class="co">#&gt; 5               1        0  56             1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adjust-for-uncontrolled-confounding">1. Adjust for uncontrolled confounding<a class="anchor" aria-label="anchor" href="#adjust-for-uncontrolled-confounding"></a>
</h2>
<p>An important confounder, smoking, was not included in our analysis!
Let’s demonstrate how we could use validation data with smoking
information to adjust for the uncontrolled confounding. Feature
<code>smoked_100cigs</code> corresponds to whether a participant
reported having smoked 100 cigarettes throughout their life.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_temp1</span> <span class="op">&lt;-</span> <span class="va">nhanes_filtered</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">smoked_100cigs</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_val1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_validation.html">data_validation</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">df_temp1</span>,</span>
<span>  true_exposure <span class="op">=</span> <span class="st">"alcohol_extreme"</span>,</span>
<span>  true_outcome <span class="op">=</span> <span class="st">"mortstat"</span>,</span>
<span>  confounders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"gender_female"</span>, <span class="st">"smoked_100cigs"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We now put these two objects into the <code>multibias</code> function
named <code><a href="../reference/adjust_uc.html">adjust_uc()</a></code> to adjust for uncontrolled confounding.
This new bias-adjusted odds ratio (1.4) is closer to the null than that
of our base model. This is not a surprise considering that extreme
drinkers are more likely to be smokers, and smoking increases the risk
of death. Due to these strong correlations, part of the alcohol effect
in our base model included the effect from smoking.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/adjust_uc.html">adjust_uc</a></span><span class="op">(</span><span class="va">df_obs</span>, <span class="va">df_val1</span><span class="op">)</span></span>
<span><span class="co">#&gt; $estimate</span></span>
<span><span class="co">#&gt; [1] 1.411961</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ci</span></span>
<span><span class="co">#&gt; [1] 1.003703 1.986279</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adjust-for-uncontrolled-confounding-and-exposure-misclassification">2. Adjust for uncontrolled confounding and exposure
misclassification<a class="anchor" aria-label="anchor" href="#adjust-for-uncontrolled-confounding-and-exposure-misclassification"></a>
</h2>
<p>What if we also wanted to account for the fact that people commonly
under-report their alcohol use due to social stigma? Let’s bring in the
assumption that wealthy, college-educated individuals are most
susceptible to this stigma. We’ll say that the actual alcohol intake for
this group, which we’ll name <code>alcohol_adj</code>, should be 1.5
times what they reported. Then based on this feature, we’ll re-calculate
the exteme drinking indicator: <code>alcohol_extreme_adj</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_temp2</span> <span class="op">&lt;-</span> <span class="va">nhanes_filtered</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">smoked_100cigs</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>alcohol_adj <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span></span>
<span>    <span class="va">income</span> <span class="op">==</span> <span class="st">"$100,000 and Over"</span> <span class="op">|</span> <span class="va">education</span> <span class="op">==</span> <span class="st">"College graduate or above"</span>,</span>
<span>    <span class="va">alcohol_day_total</span> <span class="op">*</span> <span class="fl">1.5</span>,</span>
<span>    <span class="va">alcohol_day_total</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>alcohol_extreme_adj <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">alcohol_adj</span> <span class="op">&gt;</span> <span class="fl">14</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="va">gender_female</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>    <span class="va">alcohol_adj</span> <span class="op">&gt;</span> <span class="fl">14</span> <span class="op">*</span> <span class="fl">4</span> <span class="op">&amp;</span> <span class="va">gender_female</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_val2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_validation.html">data_validation</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">df_temp2</span>,</span>
<span>  true_exposure <span class="op">=</span> <span class="st">"alcohol_extreme_adj"</span>,</span>
<span>  true_outcome <span class="op">=</span> <span class="st">"mortstat"</span>,</span>
<span>  confounders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"gender_female"</span>, <span class="st">"smoked_100cigs"</span><span class="op">)</span>,</span>
<span>  misclassified_exposure <span class="op">=</span> <span class="st">"alcohol_extreme"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We now put these two objects into the <code>multibias</code> function
named <code><a href="../reference/adjust_uc_em.html">adjust_uc_em()</a></code> to adjust for uncontrolled confounding
and exposure misclassification. The new bias-adjsted odds ratio is even
closer to the null.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/adjust_uc_em.html">adjust_uc_em</a></span><span class="op">(</span><span class="va">df_obs</span>, <span class="va">df_val2</span><span class="op">)</span></span>
<span><span class="co">#&gt; $estimate</span></span>
<span><span class="co">#&gt; [1] 1.216906</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ci</span></span>
<span><span class="co">#&gt; [1] 0.8335281 1.7766173</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adjust-for-uncontrolled-confounding-exposure-misclassification-and-selection-bias">3. Adjust for uncontrolled confounding, exposure misclassification,
and selection bias<a class="anchor" aria-label="anchor" href="#adjust-for-uncontrolled-confounding-exposure-misclassification-and-selection-bias"></a>
</h2>
<p>An astute Epidemiologist reading along here may have noticed that we
have not taken into account the NHANES sampling weights! NHANES does not
select participants in order to have a group representative of the U.S.
population, they instead over-sample from under-represented groups to
ensure there is representation across all demographic categories. This
could create a selection bias if both the exposure and outcome are
related to the selection probability.</p>
<p>There are two weights included from the two-day total nutrition
survey; we’ll combine them into a single feature.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_temp3a</span> <span class="op">&lt;-</span> <span class="va">nhanes_filtered</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">smoked_100cigs</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>alcohol_adj <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span></span>
<span>    <span class="va">income</span> <span class="op">==</span> <span class="st">"$100,000 and Over"</span> <span class="op">|</span> <span class="va">education</span> <span class="op">==</span> <span class="st">"College graduate or above"</span>,</span>
<span>    <span class="va">alcohol_day_total</span> <span class="op">*</span> <span class="fl">1.5</span>,</span>
<span>    <span class="va">alcohol_day_total</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>alcohol_extreme_adj <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">alcohol_adj</span> <span class="op">&gt;</span> <span class="fl">14</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="va">gender_female</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>    <span class="va">alcohol_adj</span> <span class="op">&gt;</span> <span class="fl">14</span> <span class="op">*</span> <span class="fl">4</span> <span class="op">&amp;</span> <span class="va">gender_female</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    weight <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">weight_day2</span> <span class="op">==</span> <span class="fl">0</span>, <span class="va">weight_day1</span>, <span class="va">weight_day2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>First, we sample with replacement based on each participant’s survey
weight to get a dataframe representing selected participants. Then we’ll
make a dataframe of the participants who are not selected here.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">selected_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">df_temp3a</span><span class="op">$</span><span class="va">seqn</span>,</span>
<span>  size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_temp3a</span><span class="op">)</span>,</span>
<span>  replace <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  prob <span class="op">=</span> <span class="va">df_temp3a</span><span class="op">$</span><span class="va">weight</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_selected_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">id</span> <span class="kw">in</span> <span class="va">selected_sample</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df_selected_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>    <span class="va">df_selected_sample</span>,</span>
<span>    <span class="va">df_temp3a</span><span class="op">[</span><span class="va">df_temp3a</span><span class="op">$</span><span class="va">seqn</span> <span class="op">==</span> <span class="va">id</span>, <span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">not_selected_sample</span> <span class="op">&lt;-</span> <span class="va">df_temp3a</span><span class="op">$</span><span class="va">seqn</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">df_temp3a</span><span class="op">$</span><span class="va">seqn</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">selected_sample</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">df_not_selected_sample</span> <span class="op">&lt;-</span> <span class="va">df_temp3a</span><span class="op">[</span><span class="va">df_temp3a</span><span class="op">$</span><span class="va">seqn</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">not_selected_sample</span>, <span class="op">]</span></span></code></pre></div>
<p>Let’s confirm that the sum of these two groups equals the row count
of the original dataframe.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">not_selected_sample</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">selected_sample</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_temp3a</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Then we’ll make our ultimate dataframe here with an indicator for
whether a given subject was or was not selected based on our sampling
procedure.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_selected_sample</span><span class="op">$</span><span class="va">selection</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">df_not_selected_sample</span><span class="op">$</span><span class="va">selection</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">df_temp3b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">df_selected_sample</span>, <span class="va">df_not_selected_sample</span><span class="op">)</span></span></code></pre></div>
<p>As usual, we make our <code>data_validation</code> object and specify
our <code>selection</code> column, which represents whether the
participant was selected into our study.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_val3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_validation.html">data_validation</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">df_temp3b</span>,</span>
<span>  true_exposure <span class="op">=</span> <span class="st">"alcohol_extreme_adj"</span>,</span>
<span>  true_outcome <span class="op">=</span> <span class="st">"mortstat"</span>,</span>
<span>  confounders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"gender_female"</span>, <span class="st">"smoked_100cigs"</span><span class="op">)</span>,</span>
<span>  misclassified_exposure <span class="op">=</span> <span class="st">"alcohol_extreme"</span>,</span>
<span>  selection <span class="op">=</span> <span class="st">"selection"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now let’s see if this differential study selection led to a bias of
our alcohol risk effect. We now put these two objects into the
<code><a href="../reference/adjust_uc_em_sel.html">adjust_uc_em_sel()</a></code> function to adjust for uncontrolled
confounding, exposure misclassification, and selection bias.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/adjust_uc_em_sel.html">adjust_uc_em_sel</a></span><span class="op">(</span><span class="va">df_obs</span>, <span class="va">df_val3</span><span class="op">)</span></span>
<span><span class="co">#&gt; $estimate</span></span>
<span><span class="co">#&gt; [1] 1.332608</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ci</span></span>
<span><span class="co">#&gt; [1] 0.9950054 1.7847580</span></span></code></pre></div>
<p>Any selection bias based on the sampling weights seems to be pretty
minor; the bias-adjusted odds ratio of the effect of alcohol on
mortality does not change much relative to the prior adjustment we
made.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Paul Brendel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
